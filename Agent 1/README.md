**ğŸ§  n8n Workflow â€” Automated Sub-Industry AI Page Generator**

---

**ğŸš€ Overview**

This **n8n workflow** automates the end-to-end generation of **Sub-Industry AI pages** â€” transforming structured data in **Google Sheets** into fully formatted, publication-ready **Markdown pages** with hero images.

All files are managed through **Google Drive and Docs**, ensuring full **traceability**, **status tracking**, and **rerun control**.

The workflow:

* Reads unprocessed records from Google Sheets  
* Generates clean content via LLMs  
* Stores Markdown and images in Drive  
* Updates tracking columns in Sheets for seamless monitoring

---

**âš™ï¸ Key Capabilities**

âœ… Reads structured data from the **Supply\_Chain** sheet and processes only new or pending rows using three status columns.

âœ… Generates **two main artifacts** per record:

* ğŸ“ A **Google Doc** containing formatted Markdown.  
* ğŸ“„ A **.md file** uploaded to a Drive folder.

âœ… Creates a **hero banner image** from an image prompt generated by the LLM using **OpenRouter Gemini**.

âœ… Updates all relevant status columns in the Google Sheet to maintain progress tracking and rerun safety.

---

**ğŸ—‚ï¸ Data Sources & Destinations**

| Type | Location | Details |
| :---- | :---- | :---- |
| **Source Sheet** | Google Sheets â€“ Doc ID: 1ynj56-BrW2mugvpC7H7D-DVuFVIkGCQ9gO03t8Bi1h4 (Sheet: Supply\_Chain) | Input data |
| **Docs Folder** | Drive Folder ID: 15bZ5C9cGR8eVtnvRqrLMB3wmUZwTeUX\_ | Creates Google Docs titled {Id} |
| **Markdown Folder** | Drive Folder ID: 12nlWSGo\_33Ss6PSd99em8ZEdxsML48Kb | Stores {Id}.md files |
| **Images Folder** | Drive Folder ID: 1AHA3gltqWVho7AnjJ0rhWpVhouIxcjDg | Stores {Id}.png hero images |

---

**ğŸ§© Status Columns in Google Sheets**

| Column | Description |
| :---- | :---- |
| **Markdown format Word Doc Created** | âœ… Set to â€œYesâ€ after Google Doc generation |
| **Markdown File Generated** | âœ… Set to â€œYesâ€ after .md upload to Drive |
| **Image Generated** | âœ… Set to â€œYesâ€ after hero image PNG upload |

---

**ğŸ”„ High-Level Flow**

1ï¸âƒ£ **Manual Trigger â†’ Google Sheets Fetch â†’ IF Filter â†’ Split In Batches**  
 2ï¸âƒ£ **Markdown Path:**

* Generate structured JSON (markdown \+ image\_prompt) via Perplexity  
* Parse, clean, and format  
* Create Google Doc â†’ Upload .md â†’ Update statuses  
   3ï¸âƒ£ **Image Path:**  
* Generate hero image via Gemini â†’ Convert Base64 â†’ Upload .png â†’ Update status  
   4ï¸âƒ£ **Optional Refinements:**  
* Alternate versions via GPT-4o-mini or Claude 3.5 Haiku

---

**ğŸ§  LLMs & Model Providers**

| Function | Provider | Model |
| :---- | :---- | :---- |
| **Primary Page Generation** | Perplexity | Custom JSON blueprint with 19 structured sections |
| **Image Generation** | OpenRouter | google/gemini-2.5-flash-image-preview |
| **Markdown Refinement** | LangChain \+ OpenRouter | gpt-4o-mini or claude-3.5-haiku |

---

**âœ¨ Perplexity Prompt Highlights**

* Follows a **19-section blueprint** (Eyebrow â†’ References)  
* Includes **KPI cards**, **Use Case Grid**, **Governance**, **FAQs**, and a **â€œLast updatedâ€** line for SEO freshness  
* Returns clean JSON only:

{ "markdown": "...", "image\_prompt": "..." }

* Safe-parse logic ensures reliability even when LLM output is malformed

---

**ğŸ§± Node Highlights**

| Node | Function |
| :---- | :---- |
| **Get row(s) in sheet4** | Reads records via Google Sheets API |
| **If6** | Filters rows missing all three status flags |
| **Convert into String** | Prepares JSON for LLM input |
| **Generate Data (Perplexity)** | Produces {markdown, image\_prompt} JSON |
| **Pass Output** | Cleans JSON, removes code fences, ensures parsing |
| **Create/Update Document** | Builds Google Doc and updates â€œDoc Createdâ€ flag |
| **Convert to Markdown \+ Upload File** | Uploads .md and updates â€œMarkdown File Generatedâ€ |
| **Generate / Convert / Upload Image** | Creates hero image, uploads .png, updates status |
| **Secondary Chains** | GPT-4o-mini / Claude 3.5 Haiku for alternate markdowns |

---

**ğŸ§© Error Handling & Rerun Safety**

âš™ï¸ Multi-layer JSON parsing (strips code fences, normalizes newlines).  
 ğŸ›¡ï¸ Three status columns prevent duplicate runs.  
 â±ï¸ Wait nodes manage rate limits.  
 âœ… Safe defaults ensure stability even with missing data.

---

**ğŸ” Prerequisites**

**Connected Credentials:**

* Google Sheets / Docs / Drive OAuth2  
* Perplexity API  
* OpenRouter API

**Required Setup:**

* Drive folders must exist  
* Sheet must contain: *Id, Industry, Subindustry, References,* and status columns

---

**â–¶ï¸ How to Run**

1ï¸âƒ£ Open workflow and verify credentials.  
 2ï¸âƒ£ Adjust folder IDs or sheet details if needed.  
 3ï¸âƒ£ Click **â€œExecute Workflowâ€** â€” only new/unprocessed rows will run.  
 4ï¸âƒ£ To rerun specific rows, clear a status cell (e.g., *Image Generated*) and run again.

---

**ğŸ”§ Extensibility**

ğŸ’¡ **Add variants:** Enable GPT-4o-mini or Claude Haiku chains for different writing styles.  
 ğŸ¨ **Enhance assets:** Add watermarking or resizing nodes for images.  
 ğŸŒ **Publish:** Connect CMS APIs to auto-publish Markdown pages after upload.

---

**âš ï¸ Known Limitations**

* Occasionally, malformed JSON from the LLM can skip image\_prompt generation.  
* Reference enrichment may insert placeholder sources â€” editorial review recommended.

---

**ğŸ§­ Maintenance Notes**

ğŸ§© Keep all Perplexity and Chain prompts aligned with the 19-section blueprint.  
 ğŸ“Š Monitor API quotas for Sheets, Drive, Docs, and LLMs.  
 ğŸ—ƒï¸ Export workflow JSON regularly for version control and environment replication.

 

