**🧠 n8n Workflow — Automated Sub-Industry AI Page Generator**

---

**🚀 Overview**

This **n8n workflow** automates the end-to-end generation of **Sub-Industry AI pages** — transforming structured data in **Google Sheets** into fully formatted, publication-ready **Markdown pages** with hero images.

All files are managed through **Google Drive and Docs**, ensuring full **traceability**, **status tracking**, and **rerun control**.

The workflow:

* Reads unprocessed records from Google Sheets  
* Generates clean content via LLMs  
* Stores Markdown and images in Drive  
* Updates tracking columns in Sheets for seamless monitoring

---

**⚙️ Key Capabilities**

✅ Reads structured data from the **Supply\_Chain** sheet and processes only new or pending rows using three status columns.

✅ Generates **two main artifacts** per record:

* 📝 A **Google Doc** containing formatted Markdown.  
* 📄 A **.md file** uploaded to a Drive folder.

✅ Creates a **hero banner image** from an image prompt generated by the LLM using **OpenRouter Gemini**.

✅ Updates all relevant status columns in the Google Sheet to maintain progress tracking and rerun safety.

---

**🗂️ Data Sources & Destinations**

| Type | Location | Details |
| :---- | :---- | :---- |
| **Source Sheet** | Google Sheets – Doc ID: 1ynj56-BrW2mugvpC7H7D-DVuFVIkGCQ9gO03t8Bi1h4 (Sheet: Supply\_Chain) | Input data |
| **Docs Folder** | Drive Folder ID: 15bZ5C9cGR8eVtnvRqrLMB3wmUZwTeUX\_ | Creates Google Docs titled {Id} |
| **Markdown Folder** | Drive Folder ID: 12nlWSGo\_33Ss6PSd99em8ZEdxsML48Kb | Stores {Id}.md files |
| **Images Folder** | Drive Folder ID: 1AHA3gltqWVho7AnjJ0rhWpVhouIxcjDg | Stores {Id}.png hero images |

---

**🧩 Status Columns in Google Sheets**

| Column | Description |
| :---- | :---- |
| **Markdown format Word Doc Created** | ✅ Set to “Yes” after Google Doc generation |
| **Markdown File Generated** | ✅ Set to “Yes” after .md upload to Drive |
| **Image Generated** | ✅ Set to “Yes” after hero image PNG upload |

---

**🔄 High-Level Flow**

1️⃣ **Manual Trigger → Google Sheets Fetch → IF Filter → Split In Batches**  
 2️⃣ **Markdown Path:**

* Generate structured JSON (markdown \+ image\_prompt) via Perplexity  
* Parse, clean, and format  
* Create Google Doc → Upload .md → Update statuses  
   3️⃣ **Image Path:**  
* Generate hero image via Gemini → Convert Base64 → Upload .png → Update status  
   4️⃣ **Optional Refinements:**  
* Alternate versions via GPT-4o-mini or Claude 3.5 Haiku

---

**🧠 LLMs & Model Providers**

| Function | Provider | Model |
| :---- | :---- | :---- |
| **Primary Page Generation** | Perplexity | Custom JSON blueprint with 19 structured sections |
| **Image Generation** | OpenRouter | google/gemini-2.5-flash-image-preview |
| **Markdown Refinement** | LangChain \+ OpenRouter | gpt-4o-mini or claude-3.5-haiku |

---

**✨ Perplexity Prompt Highlights**

* Follows a **19-section blueprint** (Eyebrow → References)  
* Includes **KPI cards**, **Use Case Grid**, **Governance**, **FAQs**, and a **“Last updated”** line for SEO freshness  
* Returns clean JSON only:

{ "markdown": "...", "image\_prompt": "..." }

* Safe-parse logic ensures reliability even when LLM output is malformed

---

**🧱 Node Highlights**

| Node | Function |
| :---- | :---- |
| **Get row(s) in sheet4** | Reads records via Google Sheets API |
| **If6** | Filters rows missing all three status flags |
| **Convert into String** | Prepares JSON for LLM input |
| **Generate Data (Perplexity)** | Produces {markdown, image\_prompt} JSON |
| **Pass Output** | Cleans JSON, removes code fences, ensures parsing |
| **Create/Update Document** | Builds Google Doc and updates “Doc Created” flag |
| **Convert to Markdown \+ Upload File** | Uploads .md and updates “Markdown File Generated” |
| **Generate / Convert / Upload Image** | Creates hero image, uploads .png, updates status |
| **Secondary Chains** | GPT-4o-mini / Claude 3.5 Haiku for alternate markdowns |

---

**🧩 Error Handling & Rerun Safety**

⚙️ Multi-layer JSON parsing (strips code fences, normalizes newlines).  
 🛡️ Three status columns prevent duplicate runs.  
 ⏱️ Wait nodes manage rate limits.  
 ✅ Safe defaults ensure stability even with missing data.

---

**🔐 Prerequisites**

**Connected Credentials:**

* Google Sheets / Docs / Drive OAuth2  
* Perplexity API  
* OpenRouter API

**Required Setup:**

* Drive folders must exist  
* Sheet must contain: *Id, Industry, Subindustry, References,* and status columns

---

**▶️ How to Run**

1️⃣ Open workflow and verify credentials.  
 2️⃣ Adjust folder IDs or sheet details if needed.  
 3️⃣ Click **“Execute Workflow”** — only new/unprocessed rows will run.  
 4️⃣ To rerun specific rows, clear a status cell (e.g., *Image Generated*) and run again.

---

**🔧 Extensibility**

💡 **Add variants:** Enable GPT-4o-mini or Claude Haiku chains for different writing styles.  
 🎨 **Enhance assets:** Add watermarking or resizing nodes for images.  
 🌐 **Publish:** Connect CMS APIs to auto-publish Markdown pages after upload.

---

**⚠️ Known Limitations**

* Occasionally, malformed JSON from the LLM can skip image\_prompt generation.  
* Reference enrichment may insert placeholder sources — editorial review recommended.

---

**🧭 Maintenance Notes**

🧩 Keep all Perplexity and Chain prompts aligned with the 19-section blueprint.  
 📊 Monitor API quotas for Sheets, Drive, Docs, and LLMs.  
 🗃️ Export workflow JSON regularly for version control and environment replication.

 

