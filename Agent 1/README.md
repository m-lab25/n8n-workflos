🧠 n8n Workflow — Automated Sub-Industry AI Page Generator
🚀 Overview

This n8n workflow automates the end-to-end generation of Sub-Industry AI pages — transforming structured data in Google Sheets into fully formatted, publication-ready Markdown pages with hero images, all managed through Google Drive and Docs for traceability and rerun control.

The workflow reads each unprocessed record, generates clean content via LLMs, stores the Markdown and image assets in Drive, updates tracking columns back in Sheets, and ensures every step is verifiable and repeatable.

⚙️ Key Capabilities

✅ Reads structured data from the Supply_Chain sheet in Google Sheets and processes only new or pending rows using three status columns.
✅ Generates two main artifacts per record:

A Google Doc containing formatted Markdown.

A .md file uploaded to a designated Drive folder.
✅ Creates a hero banner image from a concise image_prompt generated by the LLM using the OpenRouter Gemini image model.
✅ Updates all relevant status columns in the source sheet to maintain clear progress tracking and rerun safety.

🗂️ Data Sources & Destinations
Type	Location	Details
Source Sheet	Google Sheets – Doc ID: 1ynj56-BrW2mugvpC7H7D-DVuFVIkGCQ9gO03t8Bi1h4, Sheet: Supply_Chain (gid 282482400)	Input data
Docs Folder	Drive Folder ID: 15bZ5C9cGR8eVtnvRqrLMB3wmUZwTeUX_	Creates Google Docs titled {Id}
Markdown Folder	Drive Folder ID: 12nlWSGo_33Ss6PSd99em8ZEdxsML48Kb	Stores {Id}.md files
Images Folder	Drive Folder ID: 1AHA3gltqWVho7AnjJ0rhWpVhouIxcjDg	Stores {Id}.png hero images
🧩 Status Columns in Google Sheets
Column	Description
Markdown format Word Doc Created	✅ Set to “Yes” after the Google Doc is generated.
Markdown File Generated	✅ Set to “Yes” after .md upload to Drive.
Image Generated	✅ Set to “Yes” after hero image PNG upload.
🔄 High-Level Flow

Manual Trigger → Google Sheets Fetch → IF Filter → Split In Batches

Markdown Path

Generate structured JSON (markdown, image_prompt) via Perplexity.

Parse, clean, and format.

Create Google Doc → Upload .md → Update status columns.

Image Path

Generate hero image via Gemini → Convert Base64 → Upload .png → Update status.

Optional Refinement Chains

Alternate outputs via GPT-4o-mini or Claude 3.5 Haiku for editorial or stylistic variations.

🧠 LLMs & Model Providers
Function	Provider	Model
Primary Page Generation	Perplexity	Custom JSON blueprint with 19 structured sections
Image Generation	OpenRouter	google/gemini-2.5-flash-image-preview
Markdown Refinement	LangChain Node + OpenRouter	gpt-4o-mini or claude-3.5-haiku
✨ Perplexity Prompt Highlights

Enforces a 19-section blueprint (Eyebrow → References).

Embeds KPIs, Use Case Grid, Governance, FAQs, and SEO freshness line (Last updated: {today}).

Returns a clean JSON with only:

{ "markdown": "...", "image_prompt": "..." }


Safe-parse logic ensures resilience to malformed or double-stringified JSON.

🧱 Node Highlights
Node	Function
Get row(s) in sheet4	Reads records via Google Sheets API.
If6	Filters only rows missing all three status flags.
Convert into String	Prepares structured JSON for LLM input.
Generate Data (Perplexity)	Produces { markdown, image_prompt } JSON.
Pass Output	Cleans JSON, removes code fences, ensures valid parsing.
Create/Update Document	Builds Google Doc and updates “Doc Created” flag.
Convert to Markdown + Upload File	Uploads .md and updates “Markdown File Generated”.
Generate / Convert / Upload Image	Creates hero image, uploads .png, updates status.
Secondary Chains	Use GPT-4o-mini or Claude for alternative Markdown refinement.
🧩 Error Handling & Rerun Safety

Multi-layer JSON parsing with code-fence stripping, newline normalization, and fallback defaults.

Three status columns prevent duplicate processing.

Wait nodes manage rate limits during image generation.

Safe defaults ensure missing data doesn’t break the flow.

🔐 Prerequisites

Connected Credentials:

Google Sheets / Docs / Drive OAuth2

Perplexity API

OpenRouter API

Required Setup:

Drive folders and Sheet columns (Id, Industry, Subindustry, References, status flags).

▶️ How to Run

Open the workflow and verify all credential bindings.

Adjust folder IDs or sheet details as needed.

Click “Execute Workflow” — only new/unprocessed rows will run.

To rerun specific items, simply clear a status cell (e.g., Image Generated) and execute again.

🔧 Extensibility

Add variants: Use GPT-4o-mini or Claude Haiku chains for alternate tone or depth.

Enhance assets: Insert watermarking or resizing steps after image conversion.

Publish: Add CMS API nodes post-upload to deploy Markdown directly to your website.

⚠️ Known Limitations

Occasional malformed JSON due to LLM variability — fallback logic captures markdown but may skip image_prompt.

Citation accuracy: When URLs are missing, placeholders may be inserted; human editorial review recommended.

🧭 Maintenance Notes

Keep Perplexity and Chain prompts in sync with the 19-section blueprint.

Monitor API quotas for Sheets, Drive, Docs, and LLM endpoints.

Version control: export workflow JSON and note ID/folder updates in a config file.
